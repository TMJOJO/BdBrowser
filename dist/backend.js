(()=>{"use strict";class e{static createElement(e,t={},...s){const n=document.createElement(e);Object.assign(n,t);for(const e of s)n.append(e);return n}static injectTheme(e,t){const[s]=document.getElementsByTagName("bd-themes"),n=this.createElement("style",{id:e,type:"text/css",innerHTML:t});n.setAttribute("data-bd-native",""),s.append(n)}static injectCSS(e,t){const s=this.createElement("style",{id:e,type:"text/css",innerHTML:t});this.headAppend(s)}static removeCSS(e){const t=document.querySelector("style#"+e);t&&t.remove()}static injectJS(e,t,s=!0){const n=this.createElement("script",{id:e,type:"text/javascript",src:t});this.headAppend(n),s&&n.addEventListener("load",(()=>{n.remove()}),{once:!0})}}e.headAppend=document.head.append.bind(document.head);class t{static _parseType(e){switch(e){case"info":case"warn":case"error":return e;default:return"log"}}static _log(e,t,...s){e=this._parseType(e),console[e](`%c[BetterDiscord]%c %c[${t}]%c`,"color: #3E82E5; font-weight: 700;","","color: #396CB8","",...s)}static log(e,...t){this._log("log",e,...t)}static info(e,...t){this._log("info",e,...t)}static warn(e,...t){this._log("warn",e,...t)}static error(e,...t){this._log("error",e,...t)}}t.log("Backend","Initializing modules");const s=new class{constructor(e){if(!e)throw new Error("Context is required");this.context=e}createHash(){return Math.random().toString(36).substr(2,10)}reply(e,t){this.send(e.event+"-reply",t,void 0,e.hash)}on(e,t,s=!1){const n=r=>{r.data.event===e&&r.data.context!==this.context&&1==t(r.data,r.data.data)&&s&&window.removeEventListener("message",n)};window.addEventListener("message",n)}send(e,t,s=null,n){n||(n=this.createHash()),s&&this.on(e+"-reply",(e=>e.hash===n&&(s(e.data),!0)),!0),window.postMessage({source:"betterdiscord-browser-"+this.context,event:e,context:this.context,hash:n,data:t})}}("backend");t.log("Backend","Registering events"),s.on("bdbrowser-inject-css",((t,s)=>{e.injectCSS(s.id,s.css)})),s.on("bdbrowser-inject-theme",((t,s)=>{e.injectTheme(s.id,s.css)})),s.on("bdbrowser-make-requests",((e,t)=>{fetch(t.url).catch(console.error.bind(null,"REQUEST FAILED:")).then((e=>e.text())).then((t=>{s.reply(e,t)}))})),s.on("bdbrowser-get-extensionurl",((e,t)=>{s.reply(e,chrome.runtime.getURL(t.url))}));const n=chrome.runtime.getURL("dist/frontend.js");t.log("Backend","Loading frontend script from",n),e.injectJS("BetterDiscordBrowser-frontend",n,!1)})();
//# sourceMappingURL=backend.js.map