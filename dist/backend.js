(()=>{"use strict";class e{static createElement(e,t={},...n){const s=document.createElement(e);Object.assign(s,t);for(const e of n)s.append(e);return s}static injectTheme(e,t){const[n]=document.getElementsByTagName("bd-themes"),s=this.createElement("style",{id:e,type:"text/css",innerHTML:t});s.setAttribute("data-bd-native",""),n.append(s)}static injectCSS(e,t){const n=this.createElement("style",{id:e,type:"text/css",innerHTML:t});this.headAppend(n)}static removeCSS(e){const t=document.querySelector("style#"+e);t&&t.remove()}static injectJS(e,t,n=!0){const s=this.createElement("script",{id:e,type:"text/javascript",src:t});this.headAppend(s),n&&s.addEventListener("load",(()=>{s.remove()}),{once:!0})}}e.headAppend=document.head.append.bind(document.head);const t="-reply";class n{constructor(e){if(!e)throw new Error("Context is required");this.context=e}createHash(){return Math.random().toString(36).substring(2,10)}reply(e,n){this.send(e.event.concat(t),n,void 0,e.hash)}on(e,t,n=!1){const s=r=>{r.data.event===e&&r.data.context!==this.context&&!0===t(r.data,r.data.data)&&n&&window.removeEventListener("message",s)};window.addEventListener("message",s)}send(e,n,s=null,r){r||(r=this.createHash()),s&&this.on(e.concat(t),(e=>e.hash===r&&(s(e.data),!0)),!0),window.postMessage({source:"betterdiscord-browser".concat("-",this.context),event:e,context:this.context,hash:r,data:n})}}class s{static _parseType(e){switch(e){case"info":case"warn":case"error":return e;default:return"log"}}static _log(e,t,...n){e=this._parseType(e),console[e](`%c[BetterDiscord]%c %c[${t}]%c`,"color: #3E82E5; font-weight: 700;","","color: #396CB8","",...n)}static log(e,...t){this._log("log",e,...t)}static info(e,...t){this._log("info",e,...t)}static warn(e,...t){this._log("warn",e,...t)}static error(e,...t){this._log("error",e,...t)}}!function(){!function(){s.log("Backend","Registering events.");const t=new n("backend");t.on("bdbrowser-inject-css",((t,n)=>{e.injectCSS(n.id,n.css)})),t.on("bdbrowser-inject-theme",((t,n)=>{e.injectTheme(n.id,n.css)})),t.on("bdbrowser-make-requests",((e,n)=>{chrome.runtime.sendMessage({operation:"fetch",parameters:{url:n.url,options:n.options}},(function(s){s.error?console.error("BdBrowser Backend MAKE_REQUESTS failed:",n,s.error):t.reply(e,s.body)}))})),t.on("bdbrowser-get-extension-resourceurl",((e,n)=>{t.reply(e,chrome.runtime.getURL(n.url))}))}(),s.log("Backend","Initializing modules");var t;t=chrome.runtime.getURL("dist/frontend.js"),s.log("Backend","Loading frontend script from:",t),e.injectJS("BetterDiscordBrowser-frontend",t,!1)}()})();