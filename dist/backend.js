(()=>{"use strict";class e{static createElement(e,t={},...r){const n=document.createElement(e);Object.assign(n,t);for(const e of r)n.append(e);return n}static injectTheme(e,t){const[r]=document.getElementsByTagName("bd-themes"),n=this.createElement("style",{id:e,type:"text/css",innerHTML:t});n.setAttribute("data-bd-native",""),r.append(n)}static injectCSS(e,t){const r=this.createElement("style",{id:e,type:"text/css",innerHTML:t});this.headAppend(r)}static removeCSS(e){const t=document.querySelector("style#"+e);t&&t.remove()}static injectJS(e,t,r=!0){const n=this.createElement("script",{id:e,type:"text/javascript",src:t});this.headAppend(n),r&&n.addEventListener("load",(()=>{n.remove()}),{once:!0})}}e.headAppend=document.head.append.bind(document.head);const t="-reply";class r{constructor(e){if(!e)throw new Error("Context is required");this.context=e}createHash(){return Math.random().toString(36).substring(2,10)}reply(e,r){this.send(e.event.concat(t),r,void 0,e.hash)}on(e,t,r=!1){const n=s=>{s.data.event===e&&s.data.context!==this.context&&!0===t(s.data,s.data.data)&&r&&window.removeEventListener("message",n)};window.addEventListener("message",n)}send(e,r,n=null,s){s||(s=this.createHash()),n&&this.on(e.concat(t),(e=>e.hash===s&&(n(e.data),!0)),!0),window.postMessage({source:"betterdiscord-browser".concat("-",this.context),event:e,context:this.context,hash:s,data:r})}}class n{static _parseType(e){switch(e){case"info":case"warn":case"error":return e;default:return"log"}}static _log(e,t,...r){e=this._parseType(e),console[e](`%c[BetterDiscord]%c %c[${t}]%c`,"color: #3E82E5; font-weight: 700;","","color: #396CB8","",...r)}static log(e,...t){this._log("log",e,...t)}static info(e,...t){this._log("info",e,...t)}static warn(e,...t){this._log("warn",e,...t)}static error(e,...t){this._log("error",e,...t)}}!function(){!function(){n.log("Backend","Registering events.");const t=new r("backend");t.on("bdbrowser-inject-css",((t,r)=>{e.injectCSS(r.id,r.css)})),t.on("bdbrowser-inject-theme",((t,r)=>{e.injectTheme(r.id,r.css)})),t.on("bdbrowser-make-requests",((e,r)=>{r.url&&"object"==typeof r.url&&(r.options=JSON.parse(JSON.stringify(r.url)),r.options.url=void 0,r.url.url&&(r.url=r.url.url)),chrome.runtime.sendMessage({operation:"fetch",parameters:{url:r.url,options:r.options}},(function(n){n.error?console.error("BdBrowser Backend MAKE_REQUESTS failed:",r.url,n.error):t.reply(e,n.body)}))})),t.on("bdbrowser-get-extension-resourceurl",((e,r)=>{t.reply(e,chrome.runtime.getURL(r.url))}))}(),n.log("Backend","Initializing modules");var t;t=chrome.runtime.getURL("dist/frontend.js"),n.log("Backend","Loading frontend script from:",t),e.injectJS("BetterDiscordBrowser-frontend",t,!1)}()})();